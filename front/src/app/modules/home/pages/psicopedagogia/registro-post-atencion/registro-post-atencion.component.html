<div *ngIf="!sendSuccess" class="relative">
    <div class="relative">
        <form #consultaForm="ngForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="motivoConsulta" class="block text-sm font-medium text-gray-700">Motivo de la
                    consulta</label>
                <input type="text" id="motivoConsulta" [(ngModel)]="formData.motivoConsulta" name="motivoConsulta"
                    required
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
                <p *ngIf="!formData.motivoConsulta && hasError" class="text-red-500 text-xs mt-1">Este campo es
                    obligatorio</p>
            </div>

            <div>
                <label for="situacionActual" class="block text-sm font-medium text-gray-700">Situación actual</label>
                <input type="text" id="situacionActual" [(ngModel)]="formData.situacionActual" name="situacionActual"
                    required
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
                <p *ngIf="!formData.situacionActual && hasError" class="text-red-500 text-xs mt-1">Este campo es
                    obligatorio</p>
            </div>

            <div>
                <label for="diagnosticoPresuntivo" class="block text-sm font-medium text-gray-700">Diagnóstico
                    presuntivo</label>
                <div class="flex space-x-2">
                    <select id="diagnosticoPresuntivo" [(ngModel)]="formData.diagnosticoPresuntivo"
                        name="diagnosticoPresuntivo" required
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option value="" disabled selected>Select an option</option>
                        <option *ngFor="let diag of diagnosticos" [value]="diag.id">{{ diag.nombre }}</option>
                    </select>
                    <button type="button" (click)="agregarDiagnostico()"
                        class="px-4 py-2 text-white rounded-md shadow hover:bg-blue-600" style="background: #0F75BC;">
                        <svg id='Add_Graph_Report_24' width='24' height='24' viewBox='0 0 24 24'
                            xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
                            <rect width='24' height='24' stroke='none' fill='#000000' opacity='0' />
                            <g transform="matrix(0.91 0 0 0.91 12 12)">
                                <path style="stroke: none; fill: rgb(0,0,0);" transform=" translate(-13.5, -13)"
                                    d="M 6 2 C 4.9 2 4 2.9 4 4 L 4 20 C 4 21.1 4.9 22 6 22 L 13 22 L 13 21 L 13 19 L 13 18 C 13 17.448 13.448 17 14 17 L 15 17 L 16 17 L 16 16 L 16 15 C 16 14.448 16.448 14 17 14 L 18 14 L 20 14 L 20 8 L 14 2 L 6 2 z M 13 3.5 L 18.5 9 L 13 9 L 13 3.5 z M 14 11.292969 L 15.414062 12.707031 L 10.707031 17.414062 L 8.7070312 15.414062 L 7.4140625 16.707031 L 6 15.292969 L 8.7070312 12.585938 L 10.707031 14.585938 L 14 11.292969 z M 18 16 L 18 19 L 15 19 L 15 21 L 18 21 L 18 24 L 20 24 L 20 21 L 23 21 L 23 19 L 20 19 L 20 16 L 18 16 z"
                                    stroke-linecap="round" />
                            </g>
                        </svg>
                    </button>
                </div>
                <p *ngIf="!formData.diagnosticoPresuntivo && hasError" class="text-red-500 text-xs mt-1">Este campo es
                    obligatorio</p>
            </div>

            <div>
                <label for="otrosProcedimientos" class="block text-sm font-medium text-gray-700">Otros
                    procedimientos</label>
                <select id="otrosProcedimientos" [(ngModel)]="formData.otrosProcedimientos" name="otrosProcedimientos"
                    required
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="" disabled selected>Select an option</option>
                    <option value="Medicina">Medicina</option>
                    <option value="Odontología">Odontología</option>
                    <option value="Servicio Social">Servicio Social</option>
                    <option value="Externo">Externo</option>
                    <option value="Ninguno">Ninguno</option>
                </select>
                <p *ngIf="!formData.otrosProcedimientos && hasError" class="text-red-500 text-xs mt-1">Este campo es
                    obligatorio</p>
            </div>

            <div *ngIf="formData.otrosProcedimientos === 'Externo'">
                <label for="notasExterno" class="block text-sm font-medium text-gray-700">Notas</label>
                <input type="text" id="notasExterno" [(ngModel)]="formData.notasExterno" name="notasExterno"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
            </div>

            <div>
                <label for="instrumentos" class="block text-sm font-medium text-gray-700">Instrumentos utilizados</label>
                <input type="text" id="instrumentos" [(ngModel)]="formData.instrumentos" name="instrumentos"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
            </div>

            <div >
                <label for="resultados" class="block text-sm font-medium text-gray-700">Resultados obtenidos</label>
                <textarea id="resultados" [(ngModel)]="formData.resultados" name="resultados" rows="3"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
            </div>

            <div class="md:col-span-2 flex justify-center">
                <button type="submit"
                    class="mt-4 px-4 py-2 bg-[#1cbb9c] text-white rounded-md shadow-sm hover:bg-green-600">
                    Guardar
                </button>
            </div>
        </form>

        <!-- Spinner dentro del div padre -->
        <div *ngIf="isLoading" class="absolute inset-0 bg-gray-100 bg-opacity-50 flex justify-center items-center z-10">
            <div class="w-10 h-10 border-4 border-green-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
    </div>
</div>

<app-toast></app-toast>


<!-- Modal para agregar diagnóstico -->
<div *ngIf="mostrarModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-lg font-semibold">AGREGAR NUEVO DIAGNOSTICO</h2>
        <input type="text" [(ngModel)]="codigoDiagnostico" placeholder="Ingrese código"
            class="border mt-2 px-3 py-2 rounded-md w-full">
        <input type="text" [(ngModel)]="nombreDiagnostico" placeholder="Ingrese diagnóstico"
            class="border mt-2 px-3 py-2 rounded-md w-full">
        <div class="flex justify-end space-x-2 mt-4">
            <button (click)="guardarDiagnostico()"
                class="px-4 py-2 text-white rounded-md shadow" style="background-color: #1cbb9c;">Guardar</button>
            <button (click)="cerrarModal()" class="px-4 py-2 bg-gray-300 rounded-md shadow">Cancelar</button>
        </div>
    </div>

</div>