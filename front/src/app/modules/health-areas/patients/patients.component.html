<div class="w-full h-max p-10 flex-col justify-start items-start gap-6 inline-flex" [style.height]="'calc(100vh - 140px)'">
  <div class="text-[#334155] text-2xl font-medium">Pacientes</div>


  <div class="flex justify-between items-center w-full">
    <div class="flex flex-col gap-4 w-full">
      <div class="flex gap-4 items-end" [formGroup]="filterForm">
        <div class="obu-input-field">
          <label for="dni">DNI</label>
          <input onlyNumbers id="dni" type="text" name="dni" formControlName="dni"
                 class="obu-input-default"/>
        </div>
        <div class="obu-input-field">
          <label for="nombres">Nombres</label>
          <input id="nombres" type="text" name="nombres" formControlName="nombres"
                 class="obu-input-default"/>
        </div>
        <div class="obu-input-field">
          <label for="apellidos">Apellidos
          </label>
          <input id="apellidos" type="text" name="Apellidos" formControlName="apellidos"
                 class="obu-input-default"/>
        </div>
      </div>

      <div class="flex justify-between w-full">
        <div class="flex gap-4">
          <button type="button"
                  class="b-normal" (click)="clearFilter()">
            Limpiar filtros
          </button>

          <button type="button"
                  class="b-primary" (click)="searchPatients()">
            Buscar
          </button>
        </div>
        <div>
          <button type="button"
                  class="b-primary" (click)="registerPatient()">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 512 512">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="32" d="M256 112v288M400 256H112"/>
            </svg>
            Registrar paciente
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="w-full obu-card overflow-y-auto">
    <ec-table [dataSource]="patients()"  class="w-full">
      <ng-template ecTemplate="header">
        <tr>
          <th>{{ 'N°' }}</th>
          <th>{{ 'Tipo de persona' }}</th>
          <th>{{ 'DNI' }}</th>
          <th>{{ 'Nombres' }}</th>
          <th>{{ 'Apellidos' }}</th>
          <th>{{ 'Sexo' }}</th>
          <th>{{ 'Opciones' }}</th>
        </tr>
      </ng-template>

      <ng-template ecTemplate="body" let-item let-index="index">
        <tr>
          <td>{{ index + 1 }}</td>
          <td>{{ item.tipo_persona }}</td>
          <td>{{ item.dni }}</td>
          <td>{{ item.nombres }}</td>
          <td>{{ item.apellidos }}</td>
          <td>{{ item.sexo }}</td>
          <td class="flex gap-4">
            <button (click)="onEditPatient(item)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M16.862 4.487L18.549 2.799C18.9007 2.44733 19.3777 2.24976 19.875 2.24976C20.3723 2.24976 20.8493 2.44733 21.201 2.799C21.5527 3.15068 21.7502 3.62766 21.7502 4.125C21.7502 4.62235 21.5527 5.09933 21.201 5.451L10.582 16.07C10.0533 16.5984 9.40137 16.9867 8.685 17.2L6 18L6.8 15.315C7.01328 14.5986 7.40163 13.9467 7.93 13.418L16.862 4.487ZM16.862 4.487L19.5 7.125M18 14V18.75C18 19.3467 17.7629 19.919 17.341 20.341C16.919 20.763 16.3467 21 15.75 21H5.25C4.65326 21 4.08097 20.763 3.65901 20.341C3.23705 19.919 3 19.3467 3 18.75V8.25C3 7.65327 3.23705 7.08097 3.65901 6.65901C4.08097 6.23706 4.65326 6 5.25 6H10"
                  stroke="#154ECA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button (click)="onShowModalConfirmDelete(item)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M14.74 8.99997L14.394 18M9.606 18L9.26 8.99997M19.228 5.78997C19.57 5.84197 19.91 5.89697 20.25 5.95597M19.228 5.78997L18.16 19.673C18.1164 20.2382 17.8611 20.7661 17.445 21.1512C17.029 21.5363 16.4829 21.7501 15.916 21.75H8.084C7.5171 21.7501 6.97102 21.5363 6.55498 21.1512C6.13894 20.7661 5.88359 20.2382 5.84 19.673L4.772 5.78997M19.228 5.78997C18.0739 5.61549 16.9138 5.48307 15.75 5.39297M4.772 5.78997C4.43 5.84097 4.09 5.89597 3.75 5.95497M4.772 5.78997C5.92613 5.61549 7.08623 5.48307 8.25 5.39297M15.75 5.39297V4.47697C15.75 3.29697 14.84 2.31297 13.66 2.27597C12.5536 2.24061 11.4464 2.24061 10.34 2.27597C9.16 2.31297 8.25 3.29797 8.25 4.47697V5.39297M15.75 5.39297C13.2537 5.20005 10.7463 5.20005 8.25 5.39297"
                  stroke="#CA1515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </td>
        </tr>
      </ng-template>
    </ec-table>
  </div>

  @if (metadata()) {
    <div class="flex justify-end items-center gap-4 w-full">
      <span class="text-sm text-gray-500">Mostrando del {{ metadata()!.offset + 1 }} al {{ metadata()!.total > metadata()!.limit ? ((metadata()!.page + 1) * metadata()!.limit) : patients().length }} de {{metadata()!.total}} registros</span>
      <div class="flex">
        <div class="rounded p-2 {{metadata()?.offset === 0 ? 'opacity-50' : ' hover:bg-gray-100 cursor-pointer'}}" (click)="backSearchPatients()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg>
        </div>
        <div class="rounded p-2 {{metadata()!.page === metadata()!.total_pages ? 'opacity-50' : ' hover:bg-gray-100 cursor-pointer'}}" (click)="nextSearchPatients()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
          </svg>
        </div>
      </div>
    </div>
  }
</div>

<router-outlet></router-outlet>
<app-toast></app-toast>
<app-block-ui [show]="isBlockPage"></app-block-ui>

<app-modal [show]="showConfirmDelete().show" [showHeader]="false" buttonSuccess="Aceptar" [showButtonCancel]="true"
           (onNext)="onConfirmDelete()" (showChange)="onCancelDelete()">
  <div class="flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-28 h-28 text-amber-300" viewBox="0 0 512 512">
      <path d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none"
            stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/>
      <path d="M250.26 166.05L256 288l5.73-121.95a5.74 5.74 0 00-5.79-6h0a5.74 5.74 0 00-5.68 6z" fill="none"
            stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/>
      <path d="M256 367.91a20 20 0 1120-20 20 20 0 01-20 20z" stroke="currentColor" class="fill-amber-300"/>
    </svg>
  </div>
  <div class="flex justify-center items-center text-slate-500 font-bold text-xl">
    <span>¿Esta seguro de eliminar al paciente {{showConfirmDelete().patient?.nombres}}?</span>
  </div>
  <div class="text-slate-500 text-sm">
    <span>Esta acción es irreversible. ¡Si realiza esta acción, el paciente y las consultas asociadas serán eliminadas!</span>
  </div>
</app-modal>
