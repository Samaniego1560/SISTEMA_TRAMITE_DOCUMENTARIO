<div class="flex flex-col gap-4">
  <button type="button" class="w-full flex items-center gap-2 t-h2 text-brand-2 font-bold"
          (click)="active.set(!active())">
    <div class="cursor-pointer {{active() ? 'rotate-0' : '-rotate-90'}}">
      <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M13 6L8 11L3 6" stroke="#1ABB9C" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round"/>
      </svg>
    </div>
    <span>Anamnesis</span>
  </button>

  @if (active()) {
    <div class="w-full flex flex-col gap-4">
      <div class="flex w-full gap-2">
        <div class="cursor-pointer">
          <span class="t-small text-gray-600">NÂ° DNI</span>
          <div class="self-end max-w-[240px] w-full">
            <input
              #searchPatient
              type="text" name="student_code"
              [(ngModel)]="searchPatientID"
              class="i-default w-full" placeholder="Ingresar DNI"
              [disabled]="!!infoPatientDni"
            />
          </div>
        </div>

        @if (!infoPatientDni) {
          <button type="button" class="{{searchPatientID ? 'b-secondary' : 'b-disabled'}} self-end h-10"
                  (click)="onSearchPatient(searchPatient.value)" [disabled]="!searchPatientID">
            <div>
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M13.125 13.125L11.0508 11.0508M11.0508 11.0508C11.312 10.7897 11.5192 10.4796 11.6605 10.1384C11.8019 9.79716 11.8746 9.43143 11.8746 9.06208C11.8746 8.69274 11.8019 8.32701 11.6605 7.98578C11.5192 7.64455 11.312 7.3345 11.0508 7.07333C10.7897 6.81217 10.4796 6.605 10.1384 6.46366C9.79716 6.32231 9.43143 6.24957 9.06208 6.24957C8.69274 6.24957 8.32701 6.32231 7.98578 6.46366C7.64455 6.605 7.3345 6.81217 7.07333 7.07333C6.54577 7.60089 6.24939 8.31642 6.24939 9.0625C6.24939 9.80858 6.54577 10.5241 7.07333 11.0517C7.60089 11.5792 8.31642 11.8756 9.0625 11.8756C9.80858 11.8756 10.5241 11.5792 11.0517 11.0517L11.0508 11.0508ZM17.5 10C17.5 10.9849 17.306 11.9602 16.9291 12.8701C16.5522 13.7801 15.9997 14.6069 15.3033 15.3033C14.6069 15.9997 13.7801 16.5522 12.8701 16.9291C11.9602 17.306 10.9849 17.5 10 17.5C9.01509 17.5 8.03982 17.306 7.12987 16.9291C6.21993 16.5522 5.39314 15.9997 4.6967 15.3033C4.00026 14.6069 3.44781 13.7801 3.0709 12.8701C2.69399 11.9602 2.5 10.9849 2.5 10C2.5 8.01088 3.29018 6.10322 4.6967 4.6967C6.10322 3.29018 8.01088 2.5 10 2.5C11.9891 2.5 13.8968 3.29018 15.3033 4.6967C16.7098 6.10322 17.5 8.01088 17.5 10Z"
                  stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <span>Buscar</span>
          </button>
        }
      </div>
      <div class="flex flex-col gap-4">
        <div class="w-full flex    gap-4">
          <div class="grid md:grid-cols-3 lg:grid-cols-8 w-full gap-4">
            <div class="i-field col-span-2">
              <label>Apellidos</label>
              <input class="w-full" type="text" [value]="patient()?.apellidos" disabled>
            </div>
            <div class="i-field col-span-2">
              <label>Nombres</label>
              <input class="w-full" type="text" [value]="patient()?.nombres" disabled>
            </div>
            <div class="i-field">
              <label>Sexo</label>
              <input type="text" [value]="patient()?.sexo" disabled>
            </div>
            <div class="i-field">
              <label>Edad</label>
              <input type="number" [value]="patient()?.edad" disabled>
            </div>
            <div class="i-field">
              <label>Ram</label>
              <app-toggle-switch [id]="'ram'"
                                 [trueValue]="true" [falseValue]="false"
                                 [value]="!!patient()?.ram"
                                 [disabled]="true"
              ></app-toggle-switch>
            </div>
            @if (patient()?.ram) {
              <div class="i-field">
                <label>Detalle RAM</label>
                <input type="text" [value]="patient()?.alergias" disabled>
              </div>
            }
          </div>
        </div>

        <div class="flex justify-center items-center gap-4">
          @if (patient()?.id && showVaccinesRequired && !hasNextVaccines()) {
            <button type="button" class="b-secondary !bg-blue-50 !text-blue-800 self-end h-10">
              <div class="flex text-sm rounded-lg">
                <svg class="shrink-0 inline w-4 h-4 me-3 mt-[2px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                     fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                </svg>
                <span class="sr-only">Success</span>
                <div>
                  <span class="font-medium">PROTEGIDO</span>
                </div>
              </div>
            </button>
          }
          @if (patient()?.id) {
            <button
              type="button"
              class="b-secondary whitespace-nowrap h-10"
              (click)="onShowDetailPatient();">
              <div class="">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" id="injected-svg">
                  <path d="M7 10h10v2H7zM7 14h7v2H7z"></path>
                  <path
                    d="M19 3h-2c0-.55-.45-1-1-1H8c-.55 0-1 .45-1 1H5c-1.1 0-2 .9-2 2v15c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 17H5V5h2v2h10V5h2z"></path>
                </svg>
              </div>
              Ver paciente
            </button>
          }
          @if (patient()?.id && showVaccinesRequired) {
            <app-view-vaccines-detail [dni]="patient()?.dni!"/>
          }
        </div>

        @if (patient()?.id && showVaccinesRequired && hasRequiredVaccines()) {
          <div class="w-full flex p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50" role="alert">
            <svg class="shrink-0 inline w-4 h-4 me-3 mt-[2px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                 fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
            </svg>
            <span class="sr-only">Danger</span>
            <div>
              <span class="font-medium">Vacunas requeridas:</span>
              <ul class="mt-1.5 list-disc list-inside">
                @for (vaccine of requiredVaccines(); track $index) {
                  @if (vaccine.fecha_requerida) {
                    <li>Vacuna: {{ vaccine.nombre }} - Siguiente dosis: {{ vaccine.fecha_requerida }}</li>
                  }@else {
                    <li>Vacuna: {{ vaccine.nombre }}</li>
                  }
                }
              </ul>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>

@if (showInfoPatient()) {
  <app-view-patient-detail [patient]="patient()!" (close)="showInfoPatient.set(false)"></app-view-patient-detail>
}

<app-block-ui [show]="isBlockPage()"></app-block-ui>
